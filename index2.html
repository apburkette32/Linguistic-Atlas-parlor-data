var commonStyles = {
    weight: 1,
    stroke: 1,
    fillOpacity: .8
   }
   
   var layerInfo = {
   parlorLayer: {
       response: "parlor",
       color: '#b2b273'
   },
   sittingRoomLayer: {
       response: "sitting room",
       color: '#727250'
   },
   livingRoomLayer: {
     response: "living room",
     color: '#8b8b8c'
   },

   drawingRoomLayer: {
       response: "drawing room",
       color: '#333324'
   }
};

// Build empty JS object
var geoJsonLayers = {};

// Loop through first object
for (var layer in layerInfo) {
   // Populate the second object with all features that
   geoJsonLayers[layer] = L.geoJson(responses, {
       // we convert to a layer
       pointToLayer: function (feature, latlng) {
           return L.circleMarker(latlng, commonStyles);
       },
       // exist in our first object
       filter: function (feature) {
           if (feature.properties.right_response[layerInfo[layer].response]) {
               return feature;
           }
       },
       // and match the style given in first object and with getRadius()
       style: function (feature) {
           return {
               color: layerInfo[layer].color,
               fillColor: layerInfo[layer].color,
           }
       }
   }).addTo(map);
};

var sourcesLabels = {
   "parlor": geoJsonLayers.parlorLayer,
   "sitting room": geoJsonLayers.sittingRoomLayer,
   "living room": geoJsonLayers.livingRoomLayer,
   "drawing room": geoJsonLayers.drawingRoomLayer
};

L.control.layers(null, sourcesLabels, {
   collapsed: false
}).addTo(map);
   

map.on('click', function (e) {
   // Loop through object containing geojson layers
   for (var gsLayer in layerInfo) {

       // Add a function to each layer geoJsonLayers object
       // Important! We need to make a distinction between
       // gsLayer (a key in layerInfo that matches a key in geoJsonLayers) 
       // and layer (a function parameter)

       geoJsonLayers[gsLayer].eachLayer(function (layer) {

           // Compare this output and understand how data are accessed
           console.log(`layerInfo[gsLayer]: ${layerInfo[gsLayer].source} \n*******\n`)
           console.log(`geoJsonLayers[gsLayer]: ${geoJsonLayers[gsLayer]} \n*******\n`)
           console.log(`gsLayer: ${gsLayer} \n*******\n`)
           console.log(`layer: ${layer} \n*******\n`)

           var distance = e.latlng.distanceTo(layer.getLatLng()) / 1000;

           if (distance > 500) {
               layer.setStyle({
                   stroke: false,
                   fill: false
               });
           } else {
               layer.setStyle({
                   stroke: true,
                   fill: true
               });


               // Create tooltip!
               // First get the properties of the for each geojson feature
               var props = layer.feature.properties;

               var content = `<h3>${props.right_response}</h3>`;

               layer.bindTooltip(content);
           }
       });
   }
});


